    <script>
        const analyzeBtn = document.getElementById('analyzeBtn');
        const scheduleInput = document.getElementById('scheduleInput');
        const resultOutput = document.getElementById('resultOutput');

        analyzeBtn.addEventListener('click', async () => {
            const text = scheduleInput.value.trim();
            if (!text) {
                alert('请输入日程内容');
                return;
            }

            analyzeBtn.disabled = true;
            resultOutput.textContent = '分析中，请稍候...';

            try {
                // 1. 确认请求的URL是正确的
                const res = await fetch('/analyze.js', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    // 2. 确认发送的body的key是 'text'
                    body: JSON.stringify({ text: text }) 
                });

                // 3. 将响应解析为JSON
                const data = await res.json();

                // 4. 检查HTTP响应是否成功
                if (!res.ok) {
                    // 如果API返回错误，从 data.analysis 或 data.error 中获取错误信息
                    throw new Error(data.analysis || data.error || '分析请求失败');
                }

                // 5. 【最关键的修正】从解析后的data对象中，正确地获取 analysis 属性的值
                resultOutput.textContent = data.analysis;

            } catch (err) {
                // 6. 如果发生任何错误，显示错误信息
                resultOutput.textContent = `分析失败：${err.message}`;
                console.error(err);
            } finally {
                // 7. 无论成功或失败，都重新启用按钮
                analyzeBtn.disabled = false;
            }
        });
    </script>
